# Creates/Resets the gh-pages branch to the intended start state

name: "54-storybook-for-pr: Update storybook for a pr to main"
on:
  workflow_dispatch:
  pull-request:
    branches:
      - main
    paths:
      - 'frontend/**'

env:
  GH_TOKEN: ${{ github.token }}

permissions:
  contents: write
  pages: write
  id-token: write

jobs: 
  get-pr-num:
    name: Get PR Number
    runs-on: ubuntu-latest
    outputs:
      pr_number: ${{ steps.get-pr-num.outputs.pr_number }}
    steps:
    - name: Get PR number
      id: get-pr-num
      run: |
         echo "GITHUB_EVENT_PATH=${GITHUB_EVENT_PATH}"
         pull_number=$(jq --raw-output .pull_request.number "$GITHUB_EVENT_PATH")
         echo "pull_number=${pull_number}" 
         echo "pull_number=${pull_number}" >> "$GITHUB_OUTPUT"

  # build-storybook-for-each-pr:
  #   name: Build Storybook for PR
  #   runs-on: ubuntu-latest
  #   needs: [get-pr-num]

  #   steps:
  #   - name: Debugging Output
  #     run: |
  #       echo "pr_number: ${{ steps.get-pr-num.outputs.pr_number }}"
  #       echo "matrix.value: ${{ matrix.value }}"
  #       echo "matrix.value.url: ${{ matrix.value.url }}"
  #       echo "matrix.value.author: ${{ matrix.value.author }}"
  #       echo "matrix.value.number: ${{ matrix.value.number }}"
  #       echo "matrix.value.title:  ${{ matrix.value.title }}"
  #       echo "matrix.value.headRefName:  ${{ matrix.value.headRefName }}"

  #   - name: Checkout repo
  #     uses: actions/checkout@v3
  #     with:
  #       ref: ${{ matrix.value.headRefName }}
  #       fetch-depth: 1
  #       token: ${{ github.token }}

  #   - name: Setup Node.js
  #     uses: actions/setup-node@v3
  #     with:
  #       node-version: '16'
  #       cache: 'npm'
  #       cache-dependency-path: frontend/package-lock.json

  #   - name: Build Storybook for PR branch
  #     working-directory: frontend
  #     run: | # Install npm packages and build the Storybook files
  #       npm install
  #       npx build-storybook --docs -o storybook_static_${{ matrix.value.number }}
 
  #   - name: Deploy ðŸš€
  #     uses: JamesIves/github-pages-deploy-action@v4
  #     with:
  #       branch: gh-pages # The branch the action should deploy to.
  #       folder: frontend/storybook_static_${{ matrix.value.number }} # The folder that the build-storybook script generates files.
  #       clean: true # Automatically remove deleted files from the deploy branch
  #       target-folder: prs/${{ matrix.value.number }}/storybook # The folder that we serve our Storybook files from 
  


  # build-jekyll-site:
  #   name: Build Jekyll Site
  #   needs: [build-storybook-main]
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3
  #       with:
  #         ref: 'gh-pages'
  #         fetch-depth: 1
  #         token: ${{ github.token }}
  #     - name: Setup Pages
  #       uses: actions/configure-pages@v3
  #     - name: Build with Jekyll
  #       uses: actions/jekyll-build-pages@v1
  #       with:
  #         source: ./
  #         destination: ./_site
  #     - name: Upload artifact
  #       uses: actions/upload-pages-artifact@v1

  # # Deployment job
  # deploy-gh-pages:
  #   name: Deploy to GitHub Pages
  #   environment:
  #     name: github-pages
  #     url: ${{ steps.deployment.outputs.page_url }}
  #   runs-on: ubuntu-latest
  #   needs: [build-jekyll-site]
  #   steps:
  #     - name: Deploy to GitHub Pages
  #       id: deployment
  #       uses: actions/deploy-pages@v2

 